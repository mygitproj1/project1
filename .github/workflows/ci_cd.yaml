name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'

    - name: Install dependencies
      run: pip install -r requirements.txt

    - name: Run DVC pull check (Simulated Data Availability)
      # Simulates ensuring that code can pull data artifacts
      run: dvc pull data/processed

    - name: Run Unit Tests (Placeholder - Add actual tests in a /tests dir)
      run: echo "No unit tests found. Skipping. (Add 'python -m unittest discover tests' for real project)"

    - name: Docker Build Check (CD Simulation)
      # This step confirms the Dockerfile is valid and all dependencies build
      run: docker build . -t fraud-detector:ci-test

    - name: Echo CD Instruction
      run: echo "CI successful. For true CD, a final step would push the image to DockerHub/ACR/GCR."

    - name: Initialize DVC and pull metadata
      run: |
        # 1. Install DVC (since it's in requirements.txt, this might be redundant but is good practice)
        # pip install dvc[all]
        
        # 2. Initialize DVC in the CI environment (this sets up local configuration)
        dvc init --no-scm
        
        # 3. Pull the metadata pointer files (which are small and tracked by Git)
        dvc pull data/processed